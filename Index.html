<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DBK6 Swag Bucks</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #0f0f2f, #1c1c3b);
      font-family: 'Inter', sans-serif;
      color: #ffffff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container {
      background: rgba(34, 34, 52, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      max-width: 900px;
      width: 100%;
      border-radius: 20px;
      box-shadow: 0 12px 45px rgba(102, 126, 234, 0.4);
      padding: 35px 45px;
    }
    h1 { text-align: center; font-size: 2rem; color: #cfcff2; margin-bottom: 30px; }
    .form-group { margin-bottom: 20px; }
    label {
      font-size: 0.95rem; font-weight: 600;
      color: #b0b0d1; margin-bottom: 8px; display: block;
    }
    input[type="text"], input[type="number"], select {
      width: 100%; padding: 12px 15px;
      font-size: 1rem; border: 2px solid #444466;
      border-radius: 10px; background: #1a1a2e;
      color: #ddddee; transition: 0.3s;
    }
    input:focus, select:focus {
      border-color: #667eea; background: #222240; outline: none;
    }
    button {
      width: 100%; padding: 14px; margin-top: 10px;
      font-size: 1rem; font-weight: 600;
      border: none; border-radius: 10px;
      cursor: pointer; transition: background 0.3s ease;
    }
    button:hover { opacity: 0.9; }
    .btn-create { background-color: #667eea; color: white; }
    .btn-delete { background-color: #e74c3c; color: white; }
    .btn-add { background-color: #2ecc71; color: white; }
    .btn-subtract { background-color: #e67e22; color: white; }
    #taskForm {
      display: none; background: #2a2a4a;
      border-radius: 14px; padding: 25px 30px; margin-top: 35px;
    }
    h2 { margin-bottom: 20px; font-size: 1.4rem; color: #dcdcf0; text-align: center; }
    h3 { margin-top: 25px; font-weight: 600; color: #a0a0ff; }
    #ticketList {
      margin-top: 15px; max-height: 180px;
      overflow-y: auto; padding-right: 5px;
    }
    .ticket {
      background: #3b3b59; border-left: 5px solid #667eea;
      padding: 12px 18px; margin-bottom: 10px;
      border-radius: 8px; font-size: 0.95rem; color: #e0e0ff;
    }
    select:disabled { color: #888; }
    #globalHistory {
      margin-top: 10px; max-height: 250px; overflow-y: auto;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #444466; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéüÔ∏è DBK6 Swag Bucks</h1>

    <div class="form-group">
      <label for="mainUserInput">Your Name (Manager/PA):</label>
      <input type="text" id="mainUserInput" placeholder="Name" />
    </div>

    <div class="form-group">
      <label for="userSelect">Select Associate:</label>
      <select id="userSelect" onchange="switchUser()">
        <option disabled selected>Select Associate</option>
      </select>
      <input type="text" id="newUserName" placeholder="New user name" style="margin-top: 10px;" />
      <button onclick="createUser()" class="btn-create">Add AA</button>
      <button onclick="deleteUser()" class="btn-delete">Delete AA</button>
    </div>

    <div id="taskForm">
      <h2>Task Manager</h2>
      <div class="form-group">
        <label for="taskInput">Description:</label>
        <input type="text" id="taskInput" placeholder="Decription" />
      </div>
      <div class="form-group">
        <label for="ticketAmount">Swag Bucks:</label>
        <input type="number" id="ticketAmount" placeholder=" 2" min="5000" />
      </div>
      <button onclick="addTicket()" class="btn-add">Add Ticket</button>
      <button onclick="subtractTicket()" class="btn-subtract">Subtract Ticket</button>
      <h3>Total Tickets: <span id="ticketCount">0</span></h3>
      <div id="ticketList"></div>
    </div>

    <div id="historySection" style="margin-top: 40px;">
      <h2>üìú Ticket History</h2>
      <div id="globalHistory"></div>
    </div>
  </div>

  <script>
    let currentUser = null;
    let users = JSON.parse(localStorage.getItem("users")) || {};
    const userSelect = document.getElementById("userSelect");

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
    }

    function updateUserSelect() {
      userSelect.innerHTML = '<option disabled selected>Select Associate</option>';
      Object.keys(users).forEach(username => {
        const option = document.createElement("option");
        option.value = username;
        option.textContent = username;
        userSelect.appendChild(option);
      });
    }

    function switchUser() {
      const selectedUser = userSelect.value;
      if (!selectedUser) return;

      currentUser = selectedUser;
      document.getElementById("taskForm").style.display = "block";

      updateTicketDisplay();
    }

    function createUser() {
      const newUserName = document.getElementById("newUserName").value.trim();
      if (!newUserName) {
        alert("Please enter a user name.");
        return;
      }
      if (users[newUserName]) {
        alert("User already exists.");
        return;
      }

      users[newUserName] = {
        tickets: 0,
        tasks: []
      };
      saveUsers();
      updateUserSelect();
      document.getElementById("newUserName").value = "";
      userSelect.value = newUserName;
      switchUser();
    }

    function deleteUser() {
      if (!currentUser) {
        alert("No user selected.");
        return;
      }
      if (confirm(`Are you sure you want to delete user "${currentUser}"?`)) {
        delete users[currentUser];
        saveUsers();
        currentUser = null;
        updateUserSelect();
        document.getElementById("taskForm").style.display = "none";
        document.getElementById("ticketCount").textContent = "0";
        document.getElementById("ticketList").innerHTML = "";
      }
    }

    function addTicket() {
      if (!currentUser) return;

      const taskDesc = document.getElementById("taskInput").value.trim();
      const ticketAmount = parseInt(document.getElementById("ticketAmount").value, 10);

      if (!taskDesc) {
        alert("Please enter a task description.");
        return;
      }
      if (isNaN(ticketAmount) || ticketAmount < 1) {
        alert("Please enter a valid number of tickets (minimum 1).");
        return;
      }

      users[currentUser].tickets += ticketAmount;
      users[currentUser].tasks.push({ task: taskDesc, tickets: ticketAmount, type: 'add', date: new Date().toISOString() });
      saveUsers();
      updateTicketDisplay();
      updateGlobalHistory();

      document.getElementById("taskInput").value = "";
      document.getElementById("ticketAmount").value = "";
    }

    function subtractTicket() {
      if (!currentUser) return;

      const taskDesc = document.getElementById("taskInput").value.trim();
      const ticketAmount = parseInt(document.getElementById("ticketAmount").value, 10);

      if (!taskDesc) {
        alert("Please enter a task description.");
        return;
      }
      if (isNaN(ticketAmount) || ticketAmount < 1) {
        alert("Please enter a valid number of tickets (minimum 1).");
        return;
      }
      if (users[currentUser].tickets < ticketAmount) {
        alert("Cannot subtract more tickets than the user currently has.");
        return;
      }

      users[currentUser].tickets -= ticketAmount;
      users[currentUser].tasks.push({ task: taskDesc, tickets: ticketAmount, type: 'subtract', date: new Date().toISOString() });
      saveUsers();
      updateTicketDisplay();
      updateGlobalHistory();

      document.getElementById("taskInput").value = "";
      document.getElementById("ticketAmount").value = "";
    }

    function updateTicketDisplay() {
      const ticketCountSpan = document.getElementById("ticketCount");
      const ticketList = document.getElementById("ticketList");

      if (!currentUser) {
        ticketCountSpan.textContent = "0";
        ticketList.innerHTML = "";
        return;
      }

      const userData = users[currentUser];
      ticketCountSpan.textContent = userData.tickets;

      ticketList.innerHTML = "";
      userData.tasks.slice().reverse().forEach(({ task, tickets, type, date }) => {
        const div = document.createElement("div");
        div.className = "ticket";
        div.style.borderLeftColor = type === "add" ? "#2ecc71" : "#e67e22";
        const sign = type === "add" ? "+" : "-";
        div.textContent = `[${new Date(date).toLocaleString()}] ${sign}${tickets} - ${task}`;
        ticketList.appendChild(div);
      });
    }

    function updateGlobalHistory() {
      const globalHistory = document.getElementById("globalHistory");
      globalHistory.innerHTML = "";

      let allTasks = [];
      Object.entries(users).forEach(([username, data]) => {
        data.tasks.forEach(task => {
          allTasks.push({ username, ...task });
        });
      });

      allTasks.sort((a, b) => new Date(b.date) - new Date(a.date));

      allTasks.forEach(({ username, task, tickets, type, date }) => {
        const div = document.createElement("div");
        div.className = "ticket";
        div.style.borderLeftColor = type === "add" ? "#2ecc71" : "#e67e22";
        const sign = type === "add" ? "+" : "-";
        div.textContent = `[${new Date(date).toLocaleString()}] (${username}) ${sign}${tickets} - ${task}`;
        globalHistory.appendChild(div);
      });
    }

    window.onload = () => {
      updateUserSelect();
      updateGlobalHistory();
    };
  </script>
</body>
</html>
